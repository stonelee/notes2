<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta name="generator" content="nico 0.4.1">
    <meta name="theme" content="one 0.1">
    <title>drupal</title>
    <link rel="stylesheet" href="../static/one.css" />
    <link rel="stylesheet" href="../static/syntax.css" />
  </head>
  <body>
    <div class="navigation" role="navigation">
      <div class="container">
        <a class="home" href="../"></a>
      </div>
    </div>
    <div class="document">
<div class="hentry">
  <h1 class="entry-title">drupal</h1>
  <div class="entry-content"><h2 id="安装">安装</h2><p>语言文件放在 <code>profiles/standard/translations/</code></p>
<p>建立文件并配置属性</p>
<pre>cd ./sites/default
sudo cp default.settings.php settings.php
sudo chmod 666 settings.php

mkdir files
sudo chmod 777 files</pre><h2 id="开发">开发</h2><p>module file (.module), include file (.inc), install file (.install), settings.php file, and template.php file (in themes)
应该 <code>&lt;?php</code>开头，但是没有闭合标签。
这是为了避免闭合标签后出现的空格导致的错误。
template files (.tpl.php)文件中需要<code>?&gt;</code>来结尾</p>
<p>module中内部使用的方法名前面加下划线，如_function_name()，不应该被其他模块调用，同时防止错误覆盖了hook。
同时也应该加上模块名，防止与其他模块发生冲突</p>
<p>清缓存，注意权限配置，显示Notices and Errors</p>
<pre>settings.php中

error_reporting(-1);
$conf[&#39;error_level&#39;] = 2;
ini_set(&#39;display_errors&#39;, TRUE);
ini_set(&#39;display_startup_errors&#39;, TRUE);</pre><p>调试信息</p>
<ul>
<li><code>dpm</code> 使用Devel显示内容</li>
<li><code>watchdog</code>打印出日志需要在报告中查看</li>
<li><code>debug($user, &#39;User object&#39;)</code></li>
<li><code>drupal_set_message</code> 保存在session中，通过$messages显示</li>
</ul>
<p>从modules文件夹的module文件中递归寻找特定内容，并显示行号:
<code>grep -nHR --include=*.module &#39;admin/appearance&#39; modules</code></p>
<ul>
<li><code>theme_get_setting</code> 从setting中获取值</li>
<li><code>variable_get</code> 从数据库中取值，使用form也可以更改此值</li>
</ul>
<p><code>drupal_attributes</code> 将array转为属性字符串，会 check_plain 过滤特殊字符</p>
<p><code>drupal_add_js(path_to_theme() . &#39;/js/hoverintent/hoverintent.js&#39;);</code></p>
<p><code>drupal_strtolower</code> 转为小写</p>
<p><code>drupal_get_path_alias</code>， drupal_get_normal_path</p>
<p><code>drupal_match_path</code> 检查path是否符合模式</p>
<p><code>arg</code> 得到path的部分值</p>
<p>创建文件夹</p>
<pre>  $dir = file_stream_wrapper_uri_normalize($dir);
  file_prepare_directory($dir,  FILE_CREATE_DIRECTORY);</pre><ul>
<li><code>file_copy</code> 复制文件并将记录加到数据库中</li>
<li><code>file_unmanaged_delete</code> 删除文件，不影响数据库</li>
<li><p><code>file_save_upload</code> 上传文件，保存在临时表中</p>
</li>
<li><p><code>image_load</code> 加载image并返回image对象</p>
</li>
<li><code>image_scale</code> 保持比例更改image尺寸</li>
<li><code>image_save</code> 保存</li>
</ul>
<p><code>hide</code>() 在后面render父节点时不进行渲染</p>
<p><code>flood_is_allowed</code>， <code>flood_clear_event</code>，<code>flood_register_event</code>在一段时间内控制访问次数</p>
<p><code>drupal_goto</code> 重定向到url</p>
<p><code>ip_address</code> 客户端IP地址</p>
<p><code>db_query_range</code> 从数据库中查询部分内容</p>
<p><code>user_access</code> 判断用户是否有权限</p>
<p><code>menu_get_item</code> 得到导航项</p>
<p><code>drupal_get_title</code> 得到页面title</p>
<p><code>system_region_list</code> 从主题中获取regions</p>
<p><code>element_children</code> 得到元素的children，不以“#”打头</p>
<p><code>l</code> 创建链接</p>
<p><code>t</code> 翻译字符串</p>
<ul>
<li><code>!variable</code> 原样输出，适用于url</li>
<li><code>@variable</code> 通过check_plain过滤html字符</li>
<li><code>%variable</code> 过滤并使用theme_placeholder强调</li>
</ul>
<p>使用templates/node--teaser.tpl.php
<code>$vars[&#39;theme_hook_suggestions&#39;][] = &#39;node__teaser&#39;;</code></p>
<p><code>page  -&gt; region -&gt;block</code></p>
<p>template_preprocess 为template形式实现的theme提供变量</p>
<p>hook_form_alter中当$form_id为node_type_form时,
怀疑在#group为additional_settings中设置$form[&#39;rating&#39;][&#39;nodeapi_example_node_type&#39;]后,
会自动在variable中保存nodeapi_example_node_type_plan</p>
<p>contextual_links 在block右上角添加编辑链接</p>
<p>私有文件路径配置
sites/default/files/private</p>
<p>编码规范
<a href="http://drupal.org/coding-standards">http://drupal.org/coding-standards</a></p>
<p>自定义模块一般放在/sites/default/modules.
如果想在一个drupal实例中配置多个站点,共有的自定义模块放在/sites/all/modules/custom中</p>
<p>确保服务器可以读 .info 和.module,但是不可写</p>
<p>.info中files[] = first.module ;引入php functions, classes, interfaces,静态文件(包括php templates)不需要在这里声明</p>
<pre>theme(&#39;links__contextual__node&#39;, $vars)会先使用 theme_links__contextual__node(), 然后 theme_links__contextual(), 最后 theme_links(),</pre><p><code>&#39;#type&#39; =&gt; &#39;value&#39;</code>类似hidden field,但是可以存储各种类型数据,而且不会被显示到页面上</p>
<p>system_settings_form($form)会自动添加submit按钮,并存储variables</p>
<p>confirm_form确认信息</p>
<p>token_replace将token解析为相应内容</p>
<ul>
<li>Entity types 基类,包括Nodes(content), Comments, Taxonomy terms, User profile</li>
<li>Bundles 子类,例如article, blog posts, products, taxonomy</li>
<li>Fields 属性, primitive data type with validators, widgets, formatter</li>
<li>Entities 实例</li>
</ul>
<p>注意使用filter_xss($text)</p>
<p>db_query 中使用%s, %d, %d, %b</p>
<p>执行顺序request -&gt; index.php(bootstrap) -&gt; menu system -&gt; node system -&gt; theme system</p>
<p><code>hook_init ... hook_exit</code></p>
<p>When creating a link to an entity, always use entity_uri($type, $entity)</p>
<p>$types = &amp;drupal<em>static(<em>_FUNCTION</em></em>); 页面缓存,将函数名作为key.
drupal_static() 可以集中控制php静态变量,也就是需要在function的多次调用中保存但是不属于全局变量的变量,常作为同一页面请求的缓存</p>
<h2 id="drush">drush</h2><p>下载模块 <code>drush dl projectname</code></p>
<p>升级 <code>drush up</code></p>
<p>清缓存 <code>drush cc all</code></p>
<p>备份数据库 <code>drush sql-dump &gt; /path/to/filename.sql</code></p>
<h2 id="modules">modules</h2><p>eck</p>
<p>代码风格检查 coder, grammar_parser</p>
<p>调试email开发 reroute_e-mail</p>
<h2 id="php">php</h2><p>debugger: <code>Xdebug</code> or <code>the Zend Debugger</code></p>
<p>文档生成工具 <code>Doxygen</code></p>
<p><code>func_get_args</code> 得到函数的传入参数</p>
<p>5.3新语法 <code>$value ?: &quot;default&quot;</code></p>
<p><code>define</code> 定义常量</p>
<p><code>global</code> function中无法调用外面的变量，除非使用global关键字</p>
<p><code>include_once</code> 仅仅加载并执行脚本一次</p>
<p><code>var_dump</code> 打印结构</p>
<p><code>pathinfo</code> 解析file path</p>
<p><code>usort</code> 根据自定义函数进行数组排序</p>
<p><code>mt_rand</code> 随机整数</p>
<p><code>htmlentities</code> 将特殊字符转化为html字符</p>
<ul>
<li><code>explode</code> 分割字符串</li>
<li><code>implode</code> 连接字符串</li>
</ul>
<p><code>is_object()</code>
<code>is_bool()</code>
<code>is_int()</code>
<code>is_float()</code>
<code>is_string()</code>
<code>is_array()</code>
<code>is_numeric()</code></p>
<ul>
<li><code>array_merge</code> 后面的数组会覆盖前面重复的内容，如果不想覆盖，直接使用“+”</li>
<li><code>array_shift</code> 从数组头部去除数据</li>
<li><code>array_reverse</code> 反转数组</li>
<li><code>array_diff</code> 返回a中有而b中没有的</li>
</ul>
<h3 id="发邮件">发邮件</h3><pre>sudo apt-get install php-pear
sudo pear install mail
sudo pear install Net_SMTP
sudo pear install Auth_SASL
sudo pear install mail_mime
sudo apt-get install postfix</pre></div>
</div>
</div>
    <div class="footer">
      <p class="copyright">powered by <a href="http://lab.lepture.com/nico/">nico</a> 0.4.1</p>
    </div>
    <script src="http://static.alipayobjects.com/seajs/1.2.1/sea.js" data-main="../static/one.js"></script>
  </body>
</html>